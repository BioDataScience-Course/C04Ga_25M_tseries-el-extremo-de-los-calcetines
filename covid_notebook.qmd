---
title: "Impact de la COVID-19 sur la mobilité du peuple belge"
author: "Huart Hugo, Liébin Arnaud, Shaw Alan, Rochet Loïc"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr
---

<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

La Covid19 a eu une grande influence sur le quotidien des belges. Nous observons l'impact de cette maladie sur la mobilité globale dans la Belgique pendant les années de 2020 à 2022. La mobilité de référence est calculée entre le 3 janvier et le 6 février 2020, une période durant laquelle il n'y a pas encore de mesures restrictives. Nous avons pour objectif d'analyser l'impact de la Covid19 sur la mobilité en Belgique.

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

```{r}
covid <- read("data/mobility_wallonia.rds")
head(covid)
```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

```{r}
skimr::skim(covid)
```

```{r remaniement des données}
rename(covid, commerce_recreation = retail_and_recreation_percent_change_from_baseline, grocery_pharmacy = grocery_and_pharmacy_percent_change_from_baseline, parks = parks_percent_change_from_baseline, transit = transit_stations_percent_change_from_baseline, workplaces = workplaces_percent_change_from_baseline, residential = residential_percent_change_from_baseline) ->
  covid
```

```{r}
# Copie de la série initiale sous une autre nom
covid_sem <- covid
# Calcul des jours de la semaine
covid_sem$weekdays <- weekdays(as.POSIXct(covid_sem$date))
# Les données du week-end sont remplacées par des valeurs manquantes
covid_sem[covid_sem$weekdays == "Saturday" | covid_sem$weekdays == "Sunday" , 2:7] <- NA 
```

```{r}
# Copie de la série initiale sous une autre nom
covid_we <- covid
# Calcul des jours de la semaine
covid_we$weekdays <- weekdays(as.POSIXct(covid_we$date))
# Les données de la semaine sont remplacées par des valeurs manquantes
covid_we[covid_we$weekdays == "Monday" | covid_we$weekdays == "Tuesday"| covid_we$weekdays == "Wednesday" |covid_we$weekdays == "Thursday" | covid_we$weekdays == "Friday" , 2:7] <- NA 
```

### Commerce et récréation

```{r loïctest}
#création objet ts
core_ts <- ts(covid$commerce_recreation, start = c(2020, 46), frequency = 365)
plot(core_ts)
#création obbjet ts pour weekdays uniquement
core_ts_sem <- aggregate(ts(covid_sem$commerce_recreation, start = c(2020, 46), frequency = 365), 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(core_ts_sem)
#création obbjet ts pour we uniquement
core_ts_we <- aggregate(ts(covid_we$commerce_recreation, start = c(2020, 46), frequency = 365), 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(core_ts_we)
```

analyse

```{r acf recreation1}
acf(core_ts_sem)
acf(core_ts_we)
```

Le graphique de l'autocorrélation montre qu'il existe une tendance générale pour les deux séries : celle des weekdays et celle du we.

```{r statslide}
sl_core <- stat.slide(time(core_ts), core_ts,
  xmin = 0, n = 7, deltat = 10)
```

```{r tendances locales}
#local trends semaine
local.trend(core_ts_sem)
#local trends we
local.trend(core_ts_we)
```

Les différences de tendances locales sont minimes entre we et weekdays. La tendance commence par être inférieure à la moyenne de mi-février 2020 à fin mars, début avril 2020. Vers fin mars, début avril 2020, la tendance est égale à la moyenne. De la fin du mois de septembre 2020 à la fin du mois de mars 2021, elle est inférieure à la moyenne. Enfin, de fin mars 2021 à mi-octobre 2022, la tendance est supérieure à la moyenne.

```{r tendance générale}

```

### Tendances de mobilité vers les lieux de travail la semaine

Nous allons maitenant nous intéresser au déplacement vers les lieux de travails de la population belge, toujours durant cette période de 2020 à 2023. Cela nous permettra de comprendre si les restrictions sanitaires mises en place par le gouvernement ont eu un réel impact sur la quotidien des belges quant à leur déplacements vers le lieu de travail. Nous savons notamment que quelques mesures ont forcé certaines personnes à pratiquer du télé travail ou encore de rester en chômage technique.

```{r alantest}
#semaine
covid_al_ts <- ts(covid_sem$workplaces, start = c(2020, 46), frequency = 365)
covid_al_ts2 <- aggregate(covid_al_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_al_ts2, main = "Tendances de mobilité vers les lieux de travail (semaine)", xlab = "Temps (années)", ylab = "Variation de mobilité (%)")
```

Le début du graphique (début 2020) nous permet de voir les tendances générales avant le début de la pandémie et principalement avant les premières restrictions. Globalement, beaucoup de pic sont observés et les tendances sont très variables. La première chute est observée au début 2020, avec les premières restrictions. Le reste des variations correspondent aux assouplissements ou durcissements des règles. Certaines périodes correspondent également aux périodes de vacances ou de congés à des périodes prisées (Noël, Pâques, ...).

```{r}
trend_al <- local.trend(covid_al_ts2, main = "Tendance locale de la mobilité de la semaine vers le travail", xlab = "Temps (année)", ylab = "Mobilité (%) – tendance locale par rapport normale")
plot(trend_al, main = "Tendance locale de la mobilité de la semaine vers le travail", xlab = "Temps (année)", ylab = "Mobilité (%) – tendance locale par rapport normale")
trend_al_gene <- trend.test(covid_al_ts2, R = 999)
plot(trend_al_gene)
```

Le premier graphique nous permet d'avoir une idée plus précises des tendances que nous observons. La ligne noir représente nos données brutes. La ligne rouge nous permet d'avoir les tendances locales. Le second graphique reprend uniquement cette tendance locale. Nous remarquons une baisse de la mobilité qui se fait début 2020 jusqu'à 2021. Les premières restrictions sont mises en places et les travailleurs doivent obligatoirement travailler en télétravail ou arrêter leur activité (sauf pour les magasins de premières nécessités, les secteurs hospitaliers et quelques exceptions). Un plateau se forme ensuite jusqu'en moitié de 2021 avec quelques légèrent variations. Globalement, les restrictions restent les mêmes, sauf quelques petites périodes de relâchement. Suite à ce plateau, une augmentation de mobilité ressort, un relâchement global des restrictions est en cours en la réouverture des lieux de travail est en cours pour un retour à la normale vers fin 2022.

Le troisème graphique nous permet de comprendre si nos données sont réellement significatives. Nous avons une distribution semblable à celle de t de student. La ligne en pointillé représente notre valeur réel. Nous pouvons conclure après analyse du graphique que la tendance général existe dans la série.

Le dernier graphique quantille-quantille nous confirme en tendance qui suit la normale.

```{r}
tsd_al <- tsd(covid_al_ts2, method = "median", type = "additive", order = 4, time = 3)
plot(tsd_al, xlab = "Temps (semaines)") 
```

Le premier graphique nous montre notre série brute, telle que nous l'avons déjà analysée.

Le second graphique nous permet de lisser nos données pour avoir une meilleure visualisation de ce que réprésente l'évolution de la mobilité. C'est le premier graphique mais "lissé".

Les résidus nous indiquent ce qui a été extrait de cette série lissée, donc les petites variations que l'on apercoit dans la série brute.

```{r}
plot(extract(tsd_al, components = "filtered"), main = "Tendance filtrée de la mobilité vers les lieux de travail la semaine",
  xlab = "Temps (années)", ylab = "Mobilité (% par rapport à la normale)")
```

Nous nous intéressons à cette série filtrée. On observe effectivement une diminution de la mobilité au début de 2020, au moment des premières restricitons. Des assouplissements sont visibles avec une remontée des valeurs jusqu'environ septembre 2020. Un plateau est observé jusque mi 2021 et une légère rechute se fait ressentir pendant quelques mois, certainement dû à une nouvelle vague de restriction. Une remontée se fait immédiatement sentir après ça suivi d'un plateau pendant quelques moins, jusqu'en mi 2022. La dernière variations a lieu juste après pendant 3 mois, pour revenir à la normale fin 2022.

La mobilité au travail pendant la semaine a donc clairement montré l'influence des restrictions prises pendant la pandémie au cours de ces 3 années. Ces nouvelles règles ont changé fréquemment avec des relâchement ou des durcissement de ce qui était possible de faire.

### Tendances de mobilité vers les lieux de travail le week-end

Dans cette partie, nous analysons les tendances de mobilité vers les lieux de travail pendant les week-ends au cours de la pandémie de Covid-19 en Belgique. L’objectif est d’observer comment les déplacements liés au travail ont évolué par rapport à la période de référence, en étudiant les variations hebdomadaires entre 2020 et 2022.

```{r hugotest}
#WE

covid_hu_ts <- ts(covid_sem$residential, start = c(2020, 46), frequency = 365)
covid_hu_ts2 <- aggregate(covid_hu_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
plot(covid_hu_ts2, main = "Tendances de mobilité vers les lieux de travail (week-ends)", xlab = "Temps (années)", ylab = "Variation de mobilité (%)")
```

En observant le graphique, on remarque que la mobilité vers les lieux de travail durant les week-ends a fortement varié tout au long de la pandémie. Vers la fin de l’année 2020, on voit d’abord une chute importante suivie d’une remontée rapide. Cette période correspond aux mesures strictes de la deuxième vague, qui ont fortement limité les déplacements vers le travail, même le week-end.

En 2021, la fréquentation des lieux de travail reste plus basse que la normale et montre beaucoup de variations. Certains pics semblent correspondre à des moments où les règles sanitaires étaient plus souples, tandis que les baisses reflètent le retour de mesures plus strictes.

En 2022, la mobilité se stabilise à un niveau globalement plus bas. Cela traduit un retour progressif à une situation plus normale, mais on voit que les déplacements du week-end vers le travail restent moins fréquents qu’avant la pandémie, probablement en raison du maintien du télétravail dans de nombreuses situations.

Pour approfondir l’analyse des variations observées, nous nous intéressons à la tendance locale lissée de la mobilité vers les lieux de travail, qui permet de mettre en évidence l’évolution générale au-delà des fluctuations hebdomadaires.

```{r}
loca_trend_hu <-local.trend(covid_hu_ts2, main = "Tendance locale de la mobilité week-end vers le travail", xlab = "Temps (année)", ylab = "Mobilité (%) – tendance locale par rapport normale")
```

Le graphique présente deux courbes : la courbe noire en pointillés montre les variations hebdomadaires observées, tandis que la courbe rouge représente la tendance locale lissée. On observe d’abord, à la fin de l’année 2020 une forte augmentation de la tendance rouge, indiquant la sortie d’une période où la mobilité avait été très limitée par des mesures strictes.

En 2021, la tendance reste à un niveau relativement élevé et stable. Cela indique que, malgré les variations hebdomadaires visibles sur la courbe noire, la mobilité générale vers les lieux de travail le week-end reste soutenue, ponctuée par des pics et des creux correspondant aux assouplissements ou renforcements des restrictions sanitaires.

À partir de 2022, la courbe rouge montre une diminution progressive. Cette baisse traduit un retour vers une mobilité moindre le week-end, probablement lié au maintien du télétravail ou à des changements durables dans les habitudes professionnelles.

Pour résumer, l’analyse de la courbe lissée révèle un cycle clair : une montée importante fin 2020, une période stable en 2021, puis une diminution continue en 2022. Ces tendances confirment que la pandémie a influencé de manière durable la mobilité vers les lieux de travail durant les week-ends.

Maintenant, ce graphique présente le résultat du test de tendance réalisé par bootstrap. On y voit la distribution des statistiques (histogramme à gauche) et leur comparaison à une distribution normale théorique (QQ-plot à droite).

```{r}
gen_trend_hu <- trend.test(covid_hu_ts2, R = 999)
plot(gen_trend_hu)
```

L’histogramme montre les valeurs du t\* qu’on obtiendrait s’il n’y avait aucune tendance réelle. La ligne pointillée représente la valeur observée, qui se trouve clairement en dehors de la distribution: cela indique que la tendance n’est probablement pas due au hasard.

Le QQ-plot confirme que les valeurs simulées suivent bien une forme normale. Le test est fiable.

Au final, ce graphique indique qu’il existe une tendance significative dans les données.

Pour compléter les analyses précédentes, nous avons appliqué une décomposition robuste de la série temporelle. Ce graphique permet de séparer la série originale, la tendance filtrée et les résidus afin de mieux comprendre la dynamique sous-jacente.

```{r}
tsdhu <- tsd(covid_hu_ts2, method = "median", type = "additive", order = 7, time = 3)
plot(tsdhu, xlab = "Temps (semaines)")
```

La première partie montre la série brute, avec ses variations et ses fluctuations. En dessous, la courbe « filtered » correspond à la tendance extraite : elle représente l’évolution plus lente et structurelle du signal. Enfin, les résidus indiquent ce qui reste une fois la tendance retirée, c’est-à-dire les variations rapides, les variations irrégulières et les fluctuations aléatoires.

Regardons plus précisément la tendance filtrée :

```{r}
plot(extract(tsdhu, components = "filtered"), main = "Tendance filtrée de la mobilité vers les lieux de travail le week-end", xlab = "Temps (années)", ylab = "Mobilité (% par rapport à la normale)")
```

La tendance filtrée montre l’évolution générale de la mobilité en Belgique entre 2020 et 2022. On observe d’abord des valeurs élevées au début de la période, correspondant à la situation avant la mise en place des restrictions liées à la Covid-19. La mobilité diminue ensuite fortement avec l’apparition des premières mesures sanitaires (vers fin 2020).

Par la suite, la tendance évolue plus lentement, avec des phases de stabilisation et de légères remontées, montrant les périodes d’assouplissement des restrictions. Cependant, la mobilité ne retrouve jamais durablement son niveau initial et diminue progressivement vers la fin de la période. Ce graphique met donc en évidence une baisse globale et durable de la mobilité, liée aux changements induits par la pandémie.

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

...vos conclusions ici...
